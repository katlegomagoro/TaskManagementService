@inherits LayoutComponentBase
@using MudBlazor

<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />
<MudPopoverProvider /> <!-- ADD THIS LINE -->

<MudLayout>
    @if (ShouldShowHeader())
    {
        <MudAppBar Elevation="1" Color="Color.Default">
            <!-- Menu button to toggle sidebar -->
            <MudIconButton Icon="@Icons.Material.Filled.Menu" 
                           Color="Color.Inherit" 
                           Edge="Edge.Start"
                           OnClick="ToggleDrawer" />
            
            <MudAppBarSpacer />
            
            <MudText Typo="Typo.h6" Class="ml-3" Style="color: #673ab7; font-weight: bold;">
                Task Management Service
            </MudText>
            
            <MudAppBarSpacer />
            
            <!-- Auth buttons in app bar - only show when NOT on auth page -->
            @if (!IsOnAuthPage())
            {
                <MudButtonGroup Variant="Variant.Text" Class="mr-3">
                    <MudButton Variant="Variant.Text" 
                               Color="Color.Primary" 
                               Href="/auth"
                               Class="text-transform-none">
                        Sign In
                    </MudButton>
                    <MudButton Variant="Variant.Outlined" 
                               Color="Color.Secondary" 
                               Href="/auth/register"
                               Class="text-transform-none">
                        Sign Up
                    </MudButton>
                </MudButtonGroup>
            }
        </MudAppBar>
    }

    <!-- Sidebar Navigation Drawer -->
    @if (ShouldShowHeader())
    {
        <MudDrawer Elevation="1"
                   @bind-Open="_drawerOpen"
                   Variant="DrawerVariant.Responsive"
                   ClipMode="DrawerClipMode.Always"
                   Width="280px"
                   Class="mud-theme-background">
            
            <!-- Sidebar Content -->
            <div class="pa-3">
                <MudText Typo="Typo.h6" Class="mb-4" Color="Color.Primary">
                    Navigation
                </MudText>
                <NavMenu />
            </div>
            
        </MudDrawer>
    }

    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.False" Class="pa-4" Style="height: 100vh;">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>